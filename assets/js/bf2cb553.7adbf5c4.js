(self.webpackChunksap_cloud_sdk_documentation=self.webpackChunksap_cloud_sdk_documentation||[]).push([[4543],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=d(n),m=i,h=u["".concat(l,".").concat(m)]||u[m]||p[m]||o;return n?a.createElement(h,r(r({ref:t},c),{},{components:n})):a.createElement(h,r({ref:t},c))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var d=2;d<o;d++)r[d]=n[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8215:function(e,t,n){"use strict";var a=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,i=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:i},t)}},1395:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var a=n(7294),i=n(944),o=n(6010),r="tabItem_1uMI",s="tabItemActive_2DSg";var l=37,d=39;var c=function(e){var t=e.lazy,n=e.block,c=e.defaultValue,p=e.values,u=e.groupId,m=e.className,h=(0,i.Z)(),f=h.tabGroupChoices,k=h.setTabGroupChoices,v=(0,a.useState)(c),N=v[0],g=v[1],y=a.Children.toArray(e.children),C=[];if(null!=u){var b=f[u];null!=b&&b!==N&&p.some((function(e){return e.value===b}))&&g(b)}var S=function(e){var t=e.currentTarget,n=C.indexOf(t),a=p[n].value;g(a),null!=u&&(k(u,a),setTimeout((function(){var e,n,a,i,o,r,l,d;(e=t.getBoundingClientRect(),n=e.top,a=e.left,i=e.bottom,o=e.right,r=window,l=r.innerHeight,d=r.innerWidth,n>=0&&o<=d&&i<=l&&a>=0)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(s),setTimeout((function(){return t.classList.remove(s)}),2e3))}),150))},w=function(e){var t,n;switch(e.keyCode){case d:var a=C.indexOf(e.target)+1;n=C[a]||C[0];break;case l:var i=C.indexOf(e.target)-1;n=C[i]||C[C.length-1]}null==(t=n)||t.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},m)},p.map((function(e){var t=e.value,n=e.label;return a.createElement("li",{role:"tab",tabIndex:N===t?0:-1,"aria-selected":N===t,className:(0,o.Z)("tabs__item",r,{"tabs__item--active":N===t}),key:t,ref:function(e){return C.push(e)},onKeyDown:w,onFocus:S,onClick:S},n)}))),t?(0,a.cloneElement)(y.filter((function(e){return e.props.value===N}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},y.map((function(e,t){return(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==N})}))))}},9443:function(e,t,n){"use strict";var a=(0,n(7294).createContext)(void 0);t.Z=a},944:function(e,t,n){"use strict";var a=n(7294),i=n(9443);t.Z=function(){var e=(0,a.useContext)(i.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e}},3387:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return d},contentTitle:function(){return c},metadata:function(){return p},toc:function(){return u},default:function(){return h}});var a=n(2122),i=n(9756),o=(n(7294),n(3905)),r=n(1395),s=n(8215),l=["components"],d={id:"sdk-connectivity-destination-service",title:"Use Destinations To Connect To Other Systems and Services",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Destinations",description:"This article describes how the SAP Cloud SDK for Java can be used to establish connections to other systems and services like SAP S/4HANA or SAP Business Technology Platform services.",keywords:["sap","cloud","sdk","destination","java","connectivity"]},c=void 0,p={unversionedId:"java/features/connectivity/sdk-connectivity-destination-service",id:"java/features/connectivity/sdk-connectivity-destination-service",isDocsHomePage:!1,title:"Use Destinations To Connect To Other Systems and Services",description:"This article describes how the SAP Cloud SDK for Java can be used to establish connections to other systems and services like SAP S/4HANA or SAP Business Technology Platform services.",source:"@site/docs/java/features/connectivity/destinations.mdx",sourceDirName:"java/features/connectivity",slug:"/java/features/connectivity/sdk-connectivity-destination-service",permalink:"/cloud-sdk/docs/java/features/connectivity/sdk-connectivity-destination-service",editUrl:"https://github.com/SAP/cloud-sdk/edit/main/docs/java/features/connectivity/destinations.mdx",version:"current",lastUpdatedBy:"Emdee89",lastUpdatedAt:1624369078,formattedLastUpdatedAt:"6/22/2021",frontMatter:{id:"sdk-connectivity-destination-service",title:"Use Destinations To Connect To Other Systems and Services",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Destinations",description:"This article describes how the SAP Cloud SDK for Java can be used to establish connections to other systems and services like SAP S/4HANA or SAP Business Technology Platform services.",keywords:["sap","cloud","sdk","destination","java","connectivity"]},sidebar:"someSidebar",previous:{title:"BAPI/RFC",permalink:"/cloud-sdk/docs/java/features/bapi-and-rfc/bapi-and-rfc-overview"},next:{title:"HttpClient",permalink:"/cloud-sdk/docs/java/features/connectivity/sdk-connectivity-http-client"}},u=[{value:"Accessing Destinations",id:"accessing-destinations",children:[]},{value:"Supported Authentication Flows",id:"supported-authentication-flows",children:[{value:"Integrated Multi-Tenancy",id:"integrated-multi-tenancy",children:[]},{value:"Using the SAMLAssertion Authentication Type",id:"using-the-samlassertion-authentication-type",children:[]}]},{value:"Decorating Destinations",id:"decorating-destinations",children:[{value:"HTTP Destinations",id:"http-destinations",children:[]},{value:"BAPI Destinations",id:"bapi-destinations",children:[]},{value:"Connect to SAP S/4HANA On-Premise",id:"connect-to-sap-s4hana-on-premise",children:[]}]},{value:"Registering Destinations at Runtime",id:"registering-destinations-at-runtime",children:[{value:"Mocking Destinations for Testing",id:"mocking-destinations-for-testing",children:[]},{value:"Using Custom Destination Loaders",id:"using-custom-destination-loaders",children:[]}]},{value:"Provide Headers for Destinations",id:"provide-headers-for-destinations",children:[{value:"How It Works",id:"how-it-works",children:[]},{value:"Implement Own Header Provider",id:"implement-own-header-provider",children:[]}]},{value:"Retrieving Destinations",id:"retrieving-destinations",children:[{value:"Get All Destinations From the Destination Service on Cloud Foundry",id:"get-all-destinations-from-the-destination-service-on-cloud-foundry",children:[]}]},{value:"Configure HTTP Destinations for Local Deployment",id:"configure-http-destinations-for-local-deployment",children:[{value:"Background: Destination Retrieval on SAP Business Technology Platform",id:"background-destination-retrieval-on-sap-business-technology-platform",children:[]},{value:"Configuration Procedure for Localhost",id:"configuration-procedure-for-localhost",children:[]}]}],m={toc:u};function h(e){var t=e.components,n=(0,i.Z)(e,l);return(0,o.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"The SAP Cloud SDK offers some basic functionality that helps with connecting to other systems and services like SAP S/4HANA Cloud.\nThe SAP Cloud SDK introduces the general concept of a ",(0,o.kt)("inlineCode",{parentName:"p"},"Destination")," which holds basic information about how to connect to such a system.\nThat could for instance be a ",(0,o.kt)("inlineCode",{parentName:"p"},"url"),", a username, and password for basic authentication or some custom headers."),(0,o.kt)("p",null,"This concept is integrated with the ",(0,o.kt)("a",{parentName:"p",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/7e306250e08340f89d6c103e28840f30.html"},"Destination Service")," that is available on the SAP Business Technology Platform.\nIf the application has a service binding to this service in place the SAP Cloud SDK will provide access to these destinations."),(0,o.kt)("h2",{id:"accessing-destinations"},"Accessing Destinations"),(0,o.kt)("p",null,"In general destinations are accessed through the ",(0,o.kt)("inlineCode",{parentName:"p"},"DestinationAccessor"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'DestinationAccessor.getDestination("my-destination");\n')),(0,o.kt)("p",null,"This will look up the destination in the destination service if the application is running on SAP Business Technology Platform.\nOther sources like the environment variables are also considered."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Hint")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"To minimize the runtime overhead of finding destinations, the SAP Cloud SDK uses caching to internally maintain a list of already retrieved destinations.\nTherefore, subsequent calls to ",(0,o.kt)("inlineCode",{parentName:"p"},'DestinationAccessor.getDestination("my-destination");')," will be served from that cache instead of performing the look up over and over again.\nCache entries will automatically be invalidated 5 minutes after their initial creation."))),(0,o.kt)("h2",{id:"supported-authentication-flows"},"Supported Authentication Flows"),(0,o.kt)("p",null,"We provide support for the following authentication types on SAP BTP, Cloud Foundry environment."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:"left"},"Authentication Type"),(0,o.kt)("th",{parentName:"tr",align:"left"},"Parameter Name"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/4e13a04147314e8e9e54321f25d93fdc.html"},(0,o.kt)("inlineCode",{parentName:"a"},"NoAuthentication"))),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"AuthenticationType.NO_AUTHENTICATION"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/4e13a04147314e8e9e54321f25d93fdc.html"},(0,o.kt)("inlineCode",{parentName:"a"},"BasicAuthentication"))),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"AuthenticationType.BASIC_AUTHENTICATION"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/73194cc419894433994c5f0444b4c6a1.html"},(0,o.kt)("inlineCode",{parentName:"a"},"PrincipalPropogation"))),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"AuthenticationType.PRINCIPAL_PROPAGATION"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/4e13a04147314e8e9e54321f25d93fdc.html"},(0,o.kt)("inlineCode",{parentName:"a"},"ClientCertificateAuthentication"))),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"AuthenticationType.CLIENT_CERTIFICATE_AUTHENTICATION"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/b865ed651e414196b39f8922db2122c7/Cloud/en-US/e022a5eebaec4dbbabef7f5d60e13dd4.html?q=AppToAppSSO"},(0,o.kt)("inlineCode",{parentName:"a"},"AppToAppSSO"))),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"AuthenticationType.APP_TO_APP_SSO"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/4e1d742a3d45472d83b411e141729795.html"},(0,o.kt)("inlineCode",{parentName:"a"},"OAuth2ClientCredentials"))),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"AuthenticationType.OAUTH2_CLIENT_CREDENTIALS"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/c69ea6aacd714ad2ae8ceb5fc3ceea56.html"},(0,o.kt)("inlineCode",{parentName:"a"},"OAuth2SAMLBearerAssertion"))),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"AuthenticationType.OAUTH2_SAML_BEARER_ASSERTION"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/e3c333f9de6245fca326993f2397c13a.html"},(0,o.kt)("inlineCode",{parentName:"a"},"OAuth2UserTokenExchange"))),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"AuthenticationType.OAUTH2_USER_TOKEN_EXCHANGE"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/283cd2d1c72147a18c69daf681650f07.html"},(0,o.kt)("inlineCode",{parentName:"a"},"OAuth2JWTBearer"))),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"AuthenticationType.OAUTH2_JWT_BEARER"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/ceb8c4fa61e6443190185696c6d0342d.html"},(0,o.kt)("inlineCode",{parentName:"a"},"SAPAssertionSSO"))),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"AuthenticationType.SAP_ASSERTION_SSO"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/2d168c76daa1406b8567eee447eb1b2f/Cloud/en-US/a9c2c896be574077b56a7b2e2790e86c.html?q=InternalSystemAuthentication"},(0,o.kt)("inlineCode",{parentName:"a"},"InternalSystemAuthentication"))),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"AuthenticationType.INTERNAL_SYSTEM_AUTHENTICATION"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/452357cdd82a4c0ba6095b36c0057526.html"},(0,o.kt)("inlineCode",{parentName:"a"},"OAuth2Password"))),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"AuthenticationType.OAUTH2_PASSWORD"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/d81e1683bd434823abf3ceefc4ff157f.html"},(0,o.kt)("inlineCode",{parentName:"a"},"SAMLAssertion"))),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"AuthenticationType.SAML_ASSERTION"))))),(0,o.kt)("h3",{id:"integrated-multi-tenancy"},"Integrated Multi-Tenancy"),(0,o.kt)("p",null,"By default, the ",(0,o.kt)("inlineCode",{parentName:"p"},"DestinationAccessor")," is tenant aware.\nIf a tenant is available, it will be used to access the destination service on behalf of that tenant.\nIf no destination is found in the tenant-specific destination service, the SAP Cloud SDK will try to get it using the service binding of the application."),(0,o.kt)("p",null,"This default retrieval strategy can be overridden by passing options to the destination loader as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"DestinationAccessor.getLoader().tryGetDestination(destinationName, options);\n")),(0,o.kt)("p",null,"See the section on ",(0,o.kt)("a",{parentName:"p",href:"#building-destination-options"},"destination options")," below."),(0,o.kt)("h3",{id:"using-the-samlassertion-authentication-type"},"Using the SAMLAssertion Authentication Type"),(0,o.kt)("p",null,"Using the ",(0,o.kt)("a",{parentName:"p",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/d81e1683bd434823abf3ceefc4ff157f.html"},(0,o.kt)("inlineCode",{parentName:"a"},"SAMLAssertion"))," authentication types requires a different caching strategy for ",(0,o.kt)("inlineCode",{parentName:"p"},"HttpClient"),"s.\nThis is because upon authentication at the target system, a session cookie is returned, which is stored within the used ",(0,o.kt)("inlineCode",{parentName:"p"},"HttpClient")," instance.\nFor subsequent calls, the service then expects authenticated clients to include their session cookie."),(0,o.kt)("p",null,"By default, the SAP Cloud SDK uses the ",(0,o.kt)("inlineCode",{parentName:"p"},"RequestScopedHttpClientCache")," to store ",(0,o.kt)("inlineCode",{parentName:"p"},"HttpClient")," instances for the duration of a specific (incoming) request.\nUsing this default strategy results into deleting the ",(0,o.kt)("inlineCode",{parentName:"p"},"HttpClient")," (together with the session cookie) that was used to authorize at the target system, once the initial request has been handled.\nTo avoid authorizing over and over again, the SAP Cloud SDK offers the ",(0,o.kt)("inlineCode",{parentName:"p"},"TimeScopedHttpClientCache"),", which keeps existing ",(0,o.kt)("inlineCode",{parentName:"p"},"HttpClient"),"s for a certain period of time.\nThese instances are then automatically reused for consecutive (incoming) requests, so that the session is retained."),(0,o.kt)("p",null,"Switching the cache can be done as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"// run this code once in a setup step, afterwards HttpClient instances are kept for 5 minutes\nHttpClientAccessor.setHttpClientCache(new TimeScopedHttpClientCache(5, TimeUnit.MINUTES));\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Hint")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The cached ",(0,o.kt)("inlineCode",{parentName:"p"},"HttpClient")," instances are also isolated based on the tenant and principal."))),(0,o.kt)("h2",{id:"decorating-destinations"},"Decorating Destinations"),(0,o.kt)("p",null,"Depending on the use case, one needs to wrap the accessed destination before issuing a request to a system.\nThis is to make sure all required destination properties are correctly set before invoking the actual request."),(0,o.kt)("h3",{id:"http-destinations"},"HTTP Destinations"),(0,o.kt)("p",null,"In case of HTTP connections one needs to wrap the retrieved destination as ",(0,o.kt)("inlineCode",{parentName:"p"},"HttpDestination")," using ",(0,o.kt)("inlineCode",{parentName:"p"},"asHttp()"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'DestinationAccessor.getDestination("my-destination").asHttp();\n')),(0,o.kt)("p",null,"This method ensures that the required destination properties are all set to make the HTTP connection.\nWith the resulting destination instance depending on the use case one can run HTTP queries for OData or REST."),(0,o.kt)("h3",{id:"bapi-destinations"},"BAPI Destinations"),(0,o.kt)("p",null,"Similarly, for BAPI endpoints you need to use ",(0,o.kt)("inlineCode",{parentName:"p"},"asRfc()"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'DestinationAccessor.getDestination("my-destination").asRfc();\n')),(0,o.kt)("h3",{id:"connect-to-sap-s4hana-on-premise"},"Connect to SAP S/4HANA On-Premise"),(0,o.kt)("p",null,"If your destination is exposing an SAP S/4HANA On-premise service via a ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/e6c7616abb5710148cfcf3e75d96d596.html"},"Cloud Connector"))," you need to decorate the destination with ",(0,o.kt)("inlineCode",{parentName:"p"},"DefaultErpHttpDestination"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"final HttpDestination httpDestination =\ndestination.asHttp().decorate(DefaultErpHttpDestination::new);\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"This ensures the mapping of all SAP S/4HANA properties like ",(0,o.kt)("inlineCode",{parentName:"li"},"sap-client")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"sap-locale")," as HTTP request headers."),(0,o.kt)("li",{parentName:"ul"},"In case ",(0,o.kt)("strong",{parentName:"li"},"Principal Propagation")," is specified as an authentication type for the destination the SAP Cloud SDK will automatically apply it.")),(0,o.kt)("h2",{id:"registering-destinations-at-runtime"},"Registering Destinations at Runtime"),(0,o.kt)("p",null,"The SAP Cloud SDK offers convenient ways to create a destination at runtime and register it so that it will be available via ",(0,o.kt)("inlineCode",{parentName:"p"},"DestinationAccessor.getDestination()"),".\nThis is especially useful when working in a local environment.\nDestinations configured in the destination service are not available in a local setting and have to be mocked."),(0,o.kt)("h3",{id:"mocking-destinations-for-testing"},"Mocking Destinations for Testing"),(0,o.kt)("p",null,"The SAP Cloud SDK offers a ",(0,o.kt)("inlineCode",{parentName:"p"},"MockUtil")," class that is capable of injecting destinations into the ",(0,o.kt)("inlineCode",{parentName:"p"},"DestinationAccessor"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'final MockUtil mockUtil = new MockUtil();\n\nMockDestination destination = MockDestination\n            .builder("my-destination", URI.create("http://localhost:8080"))\n            .build();\n\nmockUtil.mockDestination(destination);\n\n// This will now return the mocked destination\nDestinationAccessor.getDestination("my-destination").asHttp();\n')),(0,o.kt)("p",null,"This helps with keeping production and test code nicely separated.\nThere are more overloads of the mocking on the ",(0,o.kt)("a",{parentName:"p",href:"https://help.sap.com/doc/b579bf8578954412aea2b458e8452201/1.0/en-US/com/sap/cloud/sdk/testutil/MockUtil.html"},(0,o.kt)("inlineCode",{parentName:"a"},"MockUtil")," class")," that you can use.\nRefer to ",(0,o.kt)("a",{parentName:"p",href:"https://developers.sap.com/tutorials/s4sdk-odata-service-cloud-foundry.html#b77d53b0-2d8b-449c-9a9a-9df80ee09a4e"},"these tutorial steps")," on how to mock destinations for local development and testing."),(0,o.kt)("h3",{id:"using-custom-destination-loaders"},"Using Custom Destination Loaders"),(0,o.kt)("p",null,"The above is useful for testing but not suited for productive code.\nIf you want to register custom destinations in your productive code you can use the following API:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'customHttpDestination = DefaultHttpDestination.builder("http://url")\n        .name("custom-destination")\n        .build();\n\ncustomLoader = new DefaultDestinationLoader()\n        .registerDestination(customHttpDestination);\n\nDestinationAccessor.appendDestinationLoader(loader);\n\n// This will now return the custom destination\nDestinationAccessor.getDestination("custom-destination").asHttp();\n')),(0,o.kt)("p",null,"By default, the ",(0,o.kt)("inlineCode",{parentName:"p"},"DestinationAccessor")," is using a ",(0,o.kt)("inlineCode",{parentName:"p"},"DestinationLoaderChain")," that comprises multiple loaders.\nThese are e.g. a loader to get destinations from the destination service and a loader that reads destinations from environment variables."),(0,o.kt)("p",null,"The above ",(0,o.kt)("inlineCode",{parentName:"p"},"appendDestinationLoader()")," will add the provided loader at the end of such a chain.\nThat means the new loader can operate as a fallback.\nUse ",(0,o.kt)("inlineCode",{parentName:"p"},"prependDestinationLoader()")," to add it at the beginning if you would like it to take precedence.\nLastly use ",(0,o.kt)("inlineCode",{parentName:"p"},"setLoader()")," to replace all existing loaders."),(0,o.kt)("h2",{id:"provide-headers-for-destinations"},"Provide Headers for Destinations"),(0,o.kt)("h3",{id:"how-it-works"},"How It Works"),(0,o.kt)("p",null,"You can add headers that are sent for any request over destinations.\nYou can implement custom logic that defines which headers are sent under which circumstances."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Example Use-case")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Let's imagine, you want to send an API token via a request header with any calls made over any destination in your whole application."))),(0,o.kt)("p",null,"The SAP Cloud SDK offers the interface ",(0,o.kt)("inlineCode",{parentName:"p"},"DestinationHeaderProvider")," which defines the method ",(0,o.kt)("inlineCode",{parentName:"p"},"List<Header> getHeaders(DestinationRequestContext)"),".\nAt runtime, while preparing an outbound request, the SAP Cloud SDK will use all implementations of that interface which have been registered via the Java ServiceLoader mechanism (see below).\nFor each registered implementation it invokes the method ",(0,o.kt)("inlineCode",{parentName:"p"},"getHeaders(DestinationRequestContext)")," and appends the returned headers to the currently prepared request."),(0,o.kt)("h3",{id:"implement-own-header-provider"},"Implement Own Header Provider"),(0,o.kt)("h4",{id:"implement-the-interface-destinationheaderprovider"},"Implement the Interface ",(0,o.kt)("inlineCode",{parentName:"h4"},"DestinationHeaderProvider")),(0,o.kt)("p",null,"To implement your custom destination header provider, you need to implement the interface ",(0,o.kt)("inlineCode",{parentName:"p"},"DestinationHeaderProvider"),".\nThe method ",(0,o.kt)("inlineCode",{parentName:"p"},"getHeaders")," provides access to the request specific context.\nThe method argument of type ",(0,o.kt)("inlineCode",{parentName:"p"},"DestinationRequestContext")," lets you access the general properties over which the currently prepared request will be issued.\nDepending on your logic to determine headers, you can read the following data types:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"DestinationProperties getDestination()")," (e.g. the general destination name)."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"URI getRequestUri()")," (e.g. the request specific query parameters)")),(0,o.kt)("p",null,"Here is one simple example implementation which returns the same header for each request:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'@Nonnull\n@Override\npublic List<Header> getHeaders( @Nonnull final DestinationRequestContext requestContext )\n{\n  final Header header = new Header("API-Token", obtainApiToken());\n\n  return Collections.singletonList(header);\n}\n')),(0,o.kt)("h4",{id:"make-interface-implementation-accessible"},"Make Interface Implementation Accessible"),(0,o.kt)("p",null,"The SAP Cloud SDK uses the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html"},"Service Loader")," mechanism of Java to look up the ",(0,o.kt)("inlineCode",{parentName:"p"},"DestinationHeaderProvider")," implementations at runtime.\nTo let your custom implementation be found, you need to provide a configuration file as resource in the folder ",(0,o.kt)("inlineCode",{parentName:"p"},"META-INF/services"),".\nName this resource file as the interface ",(0,o.kt)("inlineCode",{parentName:"p"},"com.sap.cloud.sdk.cloudplatform.connectivity.DestinationHeaderProvider")," and mention the fully-qualified class name of your custom implementation.\nYou can refer to several implementations by putting their fully qualified class names on separate lines."),(0,o.kt)("p",null,"Place the new folder + file in your resources folder.\nIn a Maven project the resource folder is typically ",(0,o.kt)("inlineCode",{parentName:"p"},"src/main/resources/"),".\nFor example, if your custom implementation is named ",(0,o.kt)("inlineCode",{parentName:"p"},"ApiTokenHeaderProvider")," in the package ",(0,o.kt)("inlineCode",{parentName:"p"},"com.example"),", the configuration should be as follows:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"File path & name:",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"src/main/resources/META-INF/services/com.sap.cloud.sdk.cloudplatform.connectivity.DestinationHeaderProvider\n"))),(0,o.kt)("li",{parentName:"ul"},"File content:",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"com.example.ApiTokenHeaderProvider\n")))),(0,o.kt)("h2",{id:"retrieving-destinations"},"Retrieving Destinations"),(0,o.kt)("h3",{id:"get-all-destinations-from-the-destination-service-on-cloud-foundry"},"Get All Destinations From the Destination Service on Cloud Foundry"),(0,o.kt)("p",null,"To fetch all destinations from the Destination Service, you need to make a call to ",(0,o.kt)("inlineCode",{parentName:"p"},"tryGetAllDestinations"),".\nThe method queries the ",(0,o.kt)("a",{parentName:"p",href:"https://api.sap.com/api/SAP_CP_CF_Connectivity_Destination/overview"},"Destination Service API")," and retrieves all the destinations available at the service instance and sub-account level.\nIn case there is a destination available on both the levels with the same name, then this method prioritizes the destination at the service instance level."),(0,o.kt)("p",null,"Below is the sample call to ",(0,o.kt)("inlineCode",{parentName:"p"},"tryGetAllDestinations"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"final Try<Iterable<ScpCfDestination>> destinations = destinationLoader.tryGetAllDestinations(options);\n")),(0,o.kt)("p",null,"In the above call ",(0,o.kt)("inlineCode",{parentName:"p"},"destinationLoader")," needs to be an instance of ",(0,o.kt)("inlineCode",{parentName:"p"},"ScpCfDestinationLoader"),"."),(0,o.kt)("h4",{id:"configuring-timeout-durations-when-querying-the-destination-service-on-cloud-foundry"},"Configuring Timeout Durations When Querying the Destination Service on Cloud Foundry"),(0,o.kt)("p",null,"By default, the ",(0,o.kt)("a",{parentName:"p",href:"/cloud-sdk/docs/java/features/resilience/resilience#resilience-capabilities"},(0,o.kt)("inlineCode",{parentName:"a"},"TimeLimiter")," resilience pattern")," aborts requests to the Destination Service on Cloud Foundry after 6 seconds.\nIf your app requires more time when fetching destinations, you may create your own ",(0,o.kt)("inlineCode",{parentName:"p"},"ScpCfDestinationLoader")," instance by:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"// Allow requests to take up to 10 seconds instead of just 6\nfinal DestinationLoader destinationLoader = new ScpCfDestinationLoader(Duration.ofSecond(10));\n")),(0,o.kt)("p",null,"This operation overrides the default timeout duration so that you are free to choose whatever value fits your needs."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Hint")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"You may register your ",(0,o.kt)("inlineCode",{parentName:"p"},"destinationLoader")," within the ",(0,o.kt)("inlineCode",{parentName:"p"},"DestinationAccessor")," by:"),(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-java"},"DestinationAccessor.setLoader(destinationLoader);\n")),(0,o.kt)("p",{parentName:"div"},"That way, all future requests to the Destination Service will use the increased timeout duration."))),(0,o.kt)("h4",{id:"building-destination-options"},"Building Destination Options"),(0,o.kt)("p",null,"You need to build a ",(0,o.kt)("inlineCode",{parentName:"p"},"DestinationOptions")," object and pass it as a parameter.\nIt defines how Destinations Service is queried.\nIn a simple application without provider/subscriber setup, your initial configuration is as simple as:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"final DestinationOptions options = DestinationOptions.builder().build();\n")),(0,o.kt)("p",null,"For a provider/subscriber setup, a ",(0,o.kt)("a",{parentName:"p",href:"https://help.sap.com/doc/b579bf8578954412aea2b458e8452201/1.0/en-US/com/sap/cloud/sdk/cloudplatform/connectivity/ScpCfDestinationRetrievalStrategy.html"},"retrieval strategy")," must be chosen according to your particular use case from:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ALWAYS_SUBSCRIBER")," (default)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ALWAYS_PROVIDER")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"SUBSCRIBER_THEN_PROVIDER"))),(0,o.kt)("p",null,"Here is an example for ",(0,o.kt)("inlineCode",{parentName:"p"},"SUBSCRIBER_THEN_PROVIDER")," option:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"final DestinationOptions options =\n          DestinationOptions\n              .builder()\n              .augmentBuilder(\n                  ScpCfDestinationOptionsAugmenter.augmenter().retrievalStrategy(\n                      ScpCfDestinationRetrievalStrategy.SUBSCRIBER_THEN_PROVIDER))\n              .build();\n")),(0,o.kt)("p",null,"You can similarly use other retrieval options."),(0,o.kt)("h2",{id:"configure-http-destinations-for-local-deployment"},"Configure HTTP Destinations for Local Deployment"),(0,o.kt)("p",null,"When testing your app on localhost instead of SAP BTP, you require some configuration steps to make the destination retrieval work."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"HTTP Destinations")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"This section refers to the maintenance of HTTP destinations.\nRefer to the documentation about ",(0,o.kt)("a",{parentName:"p",href:"/cloud-sdk/docs/java/features/bapi-and-rfc/bapi-and-rfc-overview"},"BAPI/RFC communication")," concerning the maintenance of RFC destinations for local deployment."))),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Works for SAP Business Application Studio too")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},'The configuration procedures outlined here work too when you launch your app "locally" inside SAP Business Application Studio.\nIt does not matter that the app does not run on your own machine.'))),(0,o.kt)("p",null,"To better understand the configuration steps, we'll outline shortly how destination retrieval works when running your app on SCP.\nThereafter, we'll outline the configuration procedures in detail."),(0,o.kt)("h3",{id:"background-destination-retrieval-on-sap-business-technology-platform"},"Background: Destination Retrieval on SAP Business Technology Platform"),(0,o.kt)("p",null,"By default, the SAP Cloud SDK uses a set of so-called destination loaders in a given order when searching for a destination via the ",(0,o.kt)("inlineCode",{parentName:"p"},"DestinationAccessor")," API:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'DestinationAccessor.tryGetDestination("MyDestination");\n')),(0,o.kt)("h4",{id:"environment-variable"},"Environment Variable"),(0,o.kt)("p",null,"The first destination loader attempts to find the requested destination in the environment variable ",(0,o.kt)("inlineCode",{parentName:"p"},"destinations"),".\nHere is an example value:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "type": "HTTP",\n    "name": "MyDestination",\n    "proxyType": "Internet",\n    "description": "This destination rocks!",\n    "authentication": "BasicAuthentication",\n    "url": "https://URL",\n    "user": "USER",\n    "password": "PASSWORD"\n  }\n]\n')),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Multiple Destinations")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"You can configure multiple destinations with that approach.\nNote that the value of the environment variable is a JSON array, so you can add further entries into it."))),(0,o.kt)("h4",{id:"sap-business-technology-platform-destination-service"},"SAP Business Technology Platform Destination Service"),(0,o.kt)("p",null,"If the previous lookup was not successful, the next destination loaders examine the environment variable ",(0,o.kt)("inlineCode",{parentName:"p"},"VCAP_SERVICES")," to see if the SAP BTP destination service is bound.\nIf so, the SAP Cloud SDK queries the SAP BTP destination service for the destination configuration per the requested destination name."),(0,o.kt)("h4",{id:"sap-business-technology-platform-connectivity-service"},"SAP Business Technology Platform Connectivity Service"),(0,o.kt)("p",null,"In case the destination is of proxy type ",(0,o.kt)("inlineCode",{parentName:"p"},"OnPremise"),", the SAP Cloud SDK performs an additional query to the SAP BTP connectivity service to obtain further proxy information and an authorization token."),(0,o.kt)("h3",{id:"configuration-procedure-for-localhost"},"Configuration Procedure for Localhost"),(0,o.kt)("h4",{id:"destinations-with-proxy-type-internet"},'Destinations With Proxy Type "Internet"'),(0,o.kt)("p",null,"Maintain the destination configuration via the environment variable ",(0,o.kt)("inlineCode",{parentName:"p"},"destinations"),".\nSee the example value above for reference."),(0,o.kt)("h4",{id:"destinations-with-proxy-type-onpremise"},"Destinations With Proxy Type ",(0,o.kt)("inlineCode",{parentName:"h4"},"OnPremise")),(0,o.kt)("p",null,"We have to some perform configuration steps to tell the SAP Cloud SDK how to access the SAP BTP destination service and connectivity service."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Are your client and server located on the same Network?")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"If your localhost (client) resides in the same network zone as the target system (server) you can access it directly.\nConfiguration of SAP BTP connectivity services is not needed.\nAll you have to do is creating a destination via environment variable ",(0,o.kt)("inlineCode",{parentName:"p"},"destinations"),"."))),(0,o.kt)("h5",{id:"maintain-vcap_services"},"Maintain ",(0,o.kt)("inlineCode",{parentName:"h5"},"VCAP_SERVICES")),(0,o.kt)("p",null,"How to create the ",(0,o.kt)("inlineCode",{parentName:"p"},"VCAP_SERVICES")," representation depends on whether the Cloud Application Programming (CAP) Model is used."),(0,o.kt)(r.Z,{groupId:"isCapUsed",defaultValue:"true",values:[{label:"CAP is used",value:"true"},{label:"CAP is not used",value:"false"}],mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"false",mdxType:"TabItem"},(0,o.kt)("p",null,"Create the ",(0,o.kt)("inlineCode",{parentName:"p"},"VCAP_SERVIES")," environment variable on the shell or operating system level.\nCopy the value of that environment variable from your app which is deployed to SCP.")),(0,o.kt)(s.Z,{value:"true",mdxType:"TabItem"},(0,o.kt)("p",null,"Create the file ",(0,o.kt)("inlineCode",{parentName:"p"},"default-env.json")," in your project's root and supply the ",(0,o.kt)("inlineCode",{parentName:"p"},"VCAP_SERVICES")," value you copied beforehand so that the file looks similar to the following shortened example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "VCAP_SERVICES": {\n    "connectivity": [\n      {\n        "label": "connectivity",\n        "plan": "lite",\n        "name": "my-connectivity",\n        "instance_name": "my-connectivity",\n        "credentials": {\n          ...\n        }\n      }\n    ],\n    "xsuaa": [\n      {\n        "label": "xsuaa",\n        "plan": "space",\n        "name": "my-xsuaa",\n        "instance_name": "my-xsuaa",\n        "credentials": {\n          ...\n        }\n      }\n    ],\n    "destination": [\n      {\n        "label": "destination",\n        "plan": "lite",\n        "name": "my-destination",\n        "instance_name": "my-destination",\n        "credentials": {\n          ...\n        }\n      }\n    ]\n  }\n}\n\n\n')),(0,o.kt)("p",null,"Furthermore, add the dependency ",(0,o.kt)("inlineCode",{parentName:"p"},"com.sap.cds:cds-integration-cloud-sdk")," to your POM file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n  <groupId>com.sap.cds</groupId>\n  <artifactId>cds-integration-cloud-sdk</artifactId>\n</dependency>\n")))),(0,o.kt)("h4",{id:"skip-destination-creation-step-for-certain-authentication-types-on-cloud-foundry"},"Skip Destination Creation Step for Certain Authentication Types on Cloud Foundry"),(0,o.kt)("p",null,"For certain authentication types i.e. ",(0,o.kt)("inlineCode",{parentName:"p"},"NoAuthentication")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"OAuth2ClientCredentials")," there is an API that eliminates the need to manually create a destination in the CF account for connecting to services."),(0,o.kt)("p",null,"Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'final Map<String, String> mapping =\n      ScpCfServiceDestinationLoader.buildClientCredentialsMapping(\n        "credentials.endpoints.service_rest_url",\n        "credentials.uaa.clientid",\n        "credentials.uaa.clientsecret",\n        "credentials.endpoints.token_url");\n')),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"ScpCfServiceDestinationLoader.buildClientCredentialsMapping")," method creates a mapping for loading a destination and provides JSON paths for all required destination properties."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'final HttpDestination destination =\n      ScpCfServiceDestinationLoader.getDestinationForService(\n        "label",\n        "serviceBindingName",\n        AuthenticationType.OAUTH2_CLIENT_CREDENTIALS,\n        mapping);\n')),(0,o.kt)("p",null,"For certain services (only SAP BTP Workflow service for now), we provide further convenience that skips the need to provide the ",(0,o.kt)("inlineCode",{parentName:"p"},"mapping")," explicitly.\nExample:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'final HttpDestination destination =\n      ScpCfServiceDestinationLoader.getDestinationForService(\n        ScpCfServiceDestinationLoader.CfServices.WORKFLOW,\n        "my-workflow");\n')),(0,o.kt)("h5",{id:"enable-access-to-sap-business-technology-platform-connectivity-service"},"Enable Access to SAP Business Technology Platform Connectivity Service"),(0,o.kt)("p",null,"The SAP BTP connectivity service builds the connection between SAP BTP and the On-premise network.\nThat is why it has strong built-in restrictions to allow it only to be called from within SCP.\nIf you call the connectivity service from your local machine, you will encounter a connection timeout.\nWe'll therefore apply port forwarding via SSH to simulate that your localhost plays the cloud app."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Deploy your app to the SAP BTP once."),(0,o.kt)("li",{parentName:"ul"},"Enable SSH access to your app container with the ",(0,o.kt)("inlineCode",{parentName:"li"},"cf")," CLI:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cf enable-ssh app-name\ncf restart app-name\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Inspect the value of the entry ",(0,o.kt)("inlineCode",{parentName:"li"},"connectivity")," of your ",(0,o.kt)("inlineCode",{parentName:"li"},"VCAP_SERVICES")," and take note of the values of the fields",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"credentials.onpremise_proxy_port")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"credentials.onpremise_proxy_host"))))),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"We'll refer to these values as ",(0,o.kt)("em",{parentName:"p"},"proxy-port")," and ",(0,o.kt)("em",{parentName:"p"},"proxy-host")," hereafter."))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Create an SSH session to your app container with the following command and let the session opened:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cf ssh app-name -L proxy-port:proxy-host:proxy-port\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Replace the value of the field ",(0,o.kt)("inlineCode",{parentName:"li"},"VCAP_SERVICES.connectivity.credentials.onpremise_proxy_host")," in your ",(0,o.kt)("inlineCode",{parentName:"li"},"default-env.json"),"\nwith ",(0,o.kt)("inlineCode",{parentName:"li"},"localhost"),".")),(0,o.kt)("div",{className:"admonition admonition-success alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Ready")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Now your local setup is ready to consume an On-premise HTTP destination."))))}h.isMDXComponent=!0},6010:function(e,t,n){"use strict";function a(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}function i(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(i&&(i+=" "),i+=t);return i}n.d(t,{Z:function(){return i}})}}]);